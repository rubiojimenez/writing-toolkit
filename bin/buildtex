#!/bin/bash
# Author: Jes√∫s Rubio
# Email: jesus@rubiojimenez.com
# Created: 2024-07
# Modified: 2026-01

# Script to compile LaTeX documents

# Basic checks
if [ $# -eq 0 ]; then
    echo "Usage: $0 <filename.tex>"
    exit 1
fi

filename="$1"

if [ ! -f "$filename" ]; then
    echo "Error: File '$filename' not found!"
    exit 1
fi

# LaTeX passes
pdflatex -interaction=nonstopmode -halt-on-error "$filename" > /dev/null

if [ $? -ne 0 ]; then
    echo "Error during pdflatex pass. Please check the logs"
    exit 1
fi

for auxfile in *.aux; do
    bibtex "${auxfile%.aux}" > /dev/null
done

pdflatex -interaction=nonstopmode -halt-on-error "$filename" > /dev/null
pdflatex -interaction=nonstopmode -halt-on-error "$filename" > /dev/null
pdflatex -interaction=nonstopmode -halt-on-error "$filename" > /dev/null

# Compilation status
if [ $? -eq 0 ]; then
    echo "Build successful."
else
    echo "Build failed."
    exit 1
fi